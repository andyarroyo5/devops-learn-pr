

[![feedback](https://www.visualstudio.com/wp-content/uploads/2017/01/feedback-button-normal.svg)](#)













[![](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31)
Microsoft](https://www.microsoft.com)



Visual
Studio



  - [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365)

  - [Azure](https://azure.microsoft.com)

  - [Office 365](https://products.office.com/en-us/business/office)

  - [Dynamics 365](https://dynamics.microsoft.com/en-us/)

  - [SQL](https://www.microsoft.com/sql-server/)

  - [Windows 10](https://www.microsoft.com/en-us/windowsforbusiness)

  - 
    
    
    
    More
    
      - Products & Services
          - [Windows
            Server](https://www.microsoft.com/cloud-platform/windows-server)
          - [Enterprise Mobility +
            Security](https://www.microsoft.com/cloud-platform/enterprise-mobility-security)
          - [Power
            BI](https://powerbi.microsoft.com/en-us/)
          - [Teams](https://products.office.com/en-us/microsoft-teams/group-chat-software)
          - [Visual Studio](https://www.visualstudio.com/)
          - [Surface for
            Business](https://www.microsoft.com/en-us/surface/business/overview)
      - Emerging Technologies
          - [AI](https://www.microsoft.com/ai/)
          - [Internet of
            Things](https://www.microsoft.com/internet-of-things)
          - [Azure Cognitive
            Services](https://azure.microsoft.com/services/cognitive-services/)
          - [Quantum](https://www.microsoft.com/quantum/)
          - [Research](https://www.microsoft.com/research/)
      - Developer & IT
          - [Docs](https://docs.microsoft.com/en-us/)
          - [TechNet](https://technet.microsoft.com/en-us/ms376608.aspx)
          - [Developer Network](https://msdn.microsoft.com/en-us)
          - [Windows Dev
            Center](https://developer.microsoft.com/en-us/windows)
          - [Windows IT Pro
            Center](https://www.microsoft.com/en-us/itpro/windows)
          - [FastTrack](https://fasttrack.microsoft.com/office)
      - Partner
          - [Partner Network](https://partner.microsoft.com/)
          - [Solution
            Providers](https://www.microsoft.com/solution-providers/)
          - [Partner
            Center](https://partnercenter.microsoft.com/partner/home)
          - [Cloud
            Hosting](https://www.microsoft.com/en-us/cloudandhosting)
      - Industries
          - [Education](https://www.microsoft.com/en-us/education)
          - [Financial
            services](https://enterprise.microsoft.com/en-us)
          - [Government](https://enterprise.microsoft.com/en-us/industries/government/)
          - [Health](https://enterprise.microsoft.com/en-us/industries/health/)
          - [Manufacturing &
            resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
          - [Retail](https://enterprise.microsoft.com/en-us/industries/retail-and-consumer-goods/)
      - Other
          - [Security](https://www.microsoft.com/security/)
          - [Licensing](https://www.microsoft.com/licensing/)
          - [AppSource](https://appsource.microsoft.com/)
          - [Azure
            Marketplace](https://azuremarketplace.microsoft.com/marketplace/)
          - [Events](https://events.microsoft.com/)
      - [View
all](https://www.microsoft.com/en-us/sitemap.aspx)
    
    













Sign
in

















[Visual Studio](https://www.visualstudio.com/) [Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

[Visual Studio Team
Services](https://www.visualstudio.com/team-services/)



Features

  - [Git](https://www.visualstudio.com/team-services/git/)
  - [TFVC](https://www.visualstudio.com/team-services/tfvc/)
  - [Agile
    Tools](https://www.visualstudio.com/team-services/agile-tools/)
  - [CI/CD](https://www.visualstudio.com/team-services/continuous-integration/)
  - [All Features](https://www.visualstudio.com/team-services/features/)





Pricing

  - [VSTS](https://www.visualstudio.com/team-services/pricing/)
  - [TFS](https://www.visualstudio.com/team-services/tfs-pricing/)
  - [Feature
    Comparisons](https://www.visualstudio.com/team-services/compare-features/)





News

  - [Release
    Notes](https://www.visualstudio.com/team-services/release-notes/)
  - [Microsoft DevOps Blog](https://blogs.msdn.microsoft.com/devops/)
  - [VSTS Customer
    Stories](https://www.visualstudio.com/team-services/case-studies/)





Support

  - [VSTS](https://www.visualstudio.com/team-services/support/)
  - [Team Foundation
    Server](https://www.visualstudio.com/team-services/tfs_support/)
  - [Documentation](https://docs.microsoft.com/en-us/vsts/index)
  - [FAQ](https://www.visualstudio.com/team-services/faq/)



[Subscriber
Access](https://my.visualstudio.com/Benefits?wt.mc_id=o~msft~vscom~nav&campaign=o~msft~vscom~nav)
[Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

































[Home](https://www.visualstudio.com)/Shift
Right to Test in
Production



















# Shift Right to Test in Production

### By Linda Webster



#### About the author





[Facebook](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Fshift-right-test-production%2F&t=Shift%20Right%20to%20Test%20in%20Production "Facebook")[Twitter](https://twitter.com/share?text=Shift%20Right%20to%20Test%20in%20Production&url=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Fshift-right-test-production%2F "Twitter")[Linkedin](https://www.linkedin.com/shareArticle?mini=true&url=https://www.visualstudio.com/learn/shift-right-test-production/&title=Shift%20Right%20to%20Test%20in%20Production&summary=There%E2%80%99s%20No%20Place%20Like%20Production%0D%0AThis%20is%20the%20third%20and%20last%20part%20of%20the%20major%20changes%20we%20made.%20As%20you%20saw%20earlier%2C%20we%20reduced%20our%20reliance%20on%20functional%20tests%20in%20the%20lab%20in%20favor%20of%20unit%20tests.%20The%20flip%20side%20of%20that%20strategy%20was%20to%20rely%20a%20lot%20more%20on%20test "Linkedin")[Email](mailto:?subject=Shift%20Right%20to%20Test%20in%20Production&body=https://www.visualstudio.com/learn/shift-right-test-production/ "Email")



















## There’s No Place Like Production

This is the third and last part of the major changes we made. As you saw
earlier, we reduced our reliance on functional tests in the lab in favor
of unit tests. The flip side of that strategy was to rely a lot more on
testing in production. When it comes to cloud services, there is no
place like
production.





[](https://www.youtube.com/watch?v=watch?v=jFXTryMp5KY&autoplay=1)





![](https://i.ytimg.com/vi/jFXTryMp5KY/maxresdefault.jpg)



![](/wp-content/uploads/2017/09/youtube_social_icon_red.png)















The full breadth and diversity of the prod environment is hard to
replicate in the lab. And the real workload of customer traffic is also
hard to simulate. Moreover, the prod environment keeps changing. It is
never constant. Even if your app doesn’t change, everything underneath
is constantly changing. The infrastructure we rely on keeps changing. So
over a period of time, we have just started doing more and more in
production.

## What We Do

When we use the term *testing in production*, we mean two things: one
set of practices that safeguards production and another set of practices
that validates the health and quality of the constantly changing
production environment.

To safeguard the production environment, we roll out changes in a
progressive and controlled manner. This is done via the ring model of
deployments and with [feature
flags](https://www.visualstudio.com/learn/progressive-experimentation-feature-flags/).

Telemetry is test data; it is test results of the real customer
workload. We are watching failures, exceptions, performance metrics,
security events, etc. The telemetry also helps us detect anomalies.
These are tests running in production. They are L3 tests described
earlier in the test taxonomy. These tests are run against test accounts.

## Fault Injection and Chaos Engineering

We do fault injection and chaos engineering to see how the system
behaves under failure conditions. We do this to validate that the
[resiliency
mechanisms](https://www.visualstudio.com/learn/patterns-resiliency-cloud/)
we have implemented actually work. We also want to validate that a
failure that starts in one subsystem is contained within that subsystem,
so that it doesn’t cascade and become a major outage for the entire
product. Without fault injection, it is difficult to prove that repair
work implemented from a prior incident would have the intended effect
until another incident occurs. Fault injection also helps us create more
realistic training drills for live site engineers (our “DRIs”) and be
more prepared to deal with real incidents.

## Fault Testing with a Circuit Breaker

Here is an example of testing we do in production with the help of fault
injection. Circuit breakers are difficult to validate outside of
production. With circuit breakers we are interested in two questions:

1.  When the circuit breaker opens, does the fallback work? It works
    with unit tests, but does it work in production? We use the fault
    injection to force a breaker to open and observe the fallback
    behavior.
2.  Does the circuit breaker open when it needs to? Does it have the
    right sensitivity threshold configured? We use the fault injection
    to force latency and disconnects to the dependencies and observe
    breaker responsiveness. How long does it take to open?

### Example: Testing a Circuit Breaker around Redis Cache

Let’s walk through this with the Redis circuit breaker. Redis is a
non-critical dependency in the product. It’s a distributed cache, which
means if it’s down, the system should continue to just work, the call
should fallback to source of the cache. If the Redis goes down, the
circuit breaker should break open and switch to the fallback. So that’s
the hypothesis that we are trying to test.

![Redis testing in
production](https://visualstudio.com/wp-content/uploads/2017/11/redis-testing-in-production.png)

In picture above we have three ATs, with the breaker in front of the
call to Redis. We want to make sure when the breaker opens, the call
goes to SQL. The test forces the circuit breaker to open through a
config change, to see that the call goes to SQL. Then another test
checks the opposite config change, to close the circuit breaker and see
that the call returns back to Redis.

This test validates that fallback behavior works when the breaker opens
but doesn’t validate the configuration of the circuit breaker settings.
Will the breaker open when it needs to? To test that question we need to
simulate actual failures.

![Redis testing with fault
injection](https://visualstudio.com/wp-content/uploads/2017/11/redis-testing-with-fault-injection.png)

This is where the fault injection comes into play. Through a fault agent
we can introduce a fault in the call going to Redis. The fault injector
blocks Redis requests, the circuit breaker opens and we can observe that
fallback works. We can now remove the fault, the circuit breaker would
send a test request to Redis. And if the test request passes, the call
reverts back to Redis. We are able to test the sensitivity of the
breaker, whether the threshold is too high or too low or whether there
are other system timeouts that interfere with the circuit breaker
behavior.

In this example, if the breaker did not open or close as expected, it
may result in a live site incident. Without the fault injection testing,
the circuit breaker would remain untested as it’s hard to do this type
of testing in lab.

## Fault Injection Learnings

Do chaos engineering, but do it in your canary environment. For us, it
is Ring 0. This is the scale unit of our service which our own team’s
engineering system runs on. If something fails in the canary, then we
are only impacting ourselves. We are not hurting customers.

You want to automate the fault injection experiments, because these are
expensive tests and the system is always changing. You can also find
more information at .

### Business Continuity and Disaster Recovery (BCDR)

The other form of fault testing is failover testing. We have failover
plans for all our services as well as subsystems. The plan includes
several things. First, we need to clearly understand the business impact
if the service goes down. Second, we need to map all the dependencies in
terms of platform, tech and people and devising the BCDR plans. Third,
we need formal documentation of the disaster recovery procedures.
Finally, we need to regularly execute the DR drills.

### Microservice Compatibility

We are at a point where we now have 30+ microservices. And these are
deployed independently. We have a service compatibility suite today, we
run that as part of rolling CI. But it’s getting more complicated with
the microservices sprawl, with so many potential compat combinations.

We rely on the production system to do some amount of compat testing.
And L3 tests are our friends for this type of testing. The basic idea is
this. Say you have three services, S1, S2, S3. They are at version 2.0.
We are updating S1 to v3 and we want to make sure it works against the
v2 of the other services. L3s are tests we run in production against
test accounts with forward reference to services in the next ring. Each
service has a pre-flight environment where it deploys first. We run L3s
for the service with forward reference to Ring0. When the tests pass, we
promote the service to Ring0. This process can then continue as the
service is promoted through subsequent rings.

## Key takeaways

### Focus on building fast and reliable quality signal

If there is one takeaway, it is to build a fast and reliable quality
signal. A signal that your team can trust on the dev box, in the master
and in release branches. It gives engineers the confidence to make
changes knowing the system will detect bugs and it will detect soon
enough for the engineers to take actions. That trust in the quality
signal allows them to push more changes. If the signal is slow or
unreliable, it kills the entire pipeline. Flakiness makes the test
automation useless and, worse, flakiness originating in one place will
spread and infect the entire pipeline. Shift-left is not just a slogan,
it is possible to flip the test pyramid. We have done it – as shown
here.

### Combined engineering drives better accountability

We think combined engineering is a good model to drive better
accountability. End-to-end accountability drives right behavior. Reduced
handoffs improve agility. That doesn’t mean specialization is not
important. It is valuable. Just don’t build special dedicated teams for
it.

### Release to Prod is only half the job

Release to prod is just half the job. The other half is ensuring quality
at scale with real workload. No place like prod for that. The prod
environment keeps changing, so you are never done with testing in
production. This includes monitoring, fault injection, failover testing,
and all other forms.



  [Linda
Webster](https://www.visualstudio.com/author/linda/ "Posts by Linda Webster")
  
2018-03-07T11:47:07+00:00 







![Linda
Webster](https://www.visualstudio.com/wp-content/uploads/2016/11/linda_avatar_1479516507-130x130.jpg)





### Linda Webster

Linda Webster is a front-end web and WordPress developer who works on
the Microsoft Visual Studio.com Team. She dabbles in web design and
loves the Seattle Seahawks and zombies.















  - [DevOps at
    Microsoft](https://www.visualstudio.com/learn/devops-at-microsoft/)
  - [How We Work with Visual Studio Team
    Services (VSTS)](#)
      - [Moving to Cloud
        Cadence](https://www.visualstudio.com/learn/moving-cloud-cadence/)
      - [How We Use Git at
        Microsoft](https://www.visualstudio.com/learn/use-git-microsoft/)
      - [Evolving Test Practices at
        Microsoft](https://www.visualstudio.com/learn/evolving-test-practices-microsoft/)
  - [How We Architect Visual Studio Team
    Services (VSTS)](#)
      - [From Monolith to Cloud
        Service](https://www.visualstudio.com/learn/monolith-cloud-service/)
      - [Achieving No Downtime Through
        Versioned Service
        Updates](https://www.visualstudio.com/learn/achieving-no-downtime-versioned-service-updates/)
      - [Progressive Experimentation with
        Feature
        Flags](https://www.visualstudio.com/learn/progressive-experimentation-feature-flags/)
      - [Patterns for Resiliency in the
        Cloud](https://www.visualstudio.com/learn/patterns-resiliency-cloud/)
      - [Shift Left to Make Testing Fast and
        Reliable](https://www.visualstudio.com/learn/shift-left-make-testing-fast-reliable/)
      - [Eliminating Flaky
        Tests](https://www.visualstudio.com/learn/eliminating-flaky-tests/)
      - [Shift Right to Test in
        Production](https://www.visualstudio.com/learn/shift-right-test-production/)
  - [One Engineering System at
    Microsoft](#)
      - [Moving 65,000 Microsofties to DevOps
        on the Public
        Cloud](https://www.visualstudio.com/learn/moving-65000-microsofties-devops-public-cloud/)
      - [Universal Store: Journey to
        Continuous Delivery and
        DevOps](https://www.visualstudio.com/learn/universal-store-journey-continuous-delivery-devops/)
  - [Microsoft Research on DevOps
    Productivity](#)
      - [Boosting your code reviews with
        useful
        comments](https://www.visualstudio.com/learn/boosting-code-reviews-useful-comments/)
      - [Code reviews are not (primarily) for
        finding
        bugs](https://www.visualstudio.com/learn/code-reviews-not-primarily-finding-bugs/)
      - [Code ownership and software
        quality](https://www.visualstudio.com/learn/code-ownership-software-quality/)
      - [Getting the noise out of test
        runs](https://www.visualstudio.com/learn/getting-noise-test-runs/)
      - [Improving software security with
        stack traces from bug
        reports](https://www.visualstudio.com/learn/improving-software-security-stack-traces-bug-reports/)
      - [Is 100% code coverage worth the
        cost?](https://www.visualstudio.com/learn/100-code-coverage-worth-cost/)
      - [Software testing at scale to
        increase
        velocity](https://www.visualstudio.com/learn/software-testing-scale-increase-velocity/)
      - [Test while building to maximize test
        effectiveness and minimize
        cost](https://www.visualstudio.com/learn/test-building-maximize-test-effectiveness-minimize-cost/)
      - [Using a simple code churn metric to
        find software
        bugs](https://www.visualstudio.com/learn/using-simple-code-churn-metric-find-software-bugs/)



















  - [** DevOps at Microsoft](/learn/devops-at-microsoft/)
  - [** Blog](https://blogs.msdn.microsoft.com/devops/)
  - [** Learn DevOps](/learn/what-is-devops/)
  - [![](/wp-content/uploads/2016/11/git-footer-icons-dark_2.png) Learn
    Git](/learn-git/)
  - [** Learn Agile](/agile/)
  - [** DevOps Self-Assessment](https://devopsassessment.net/)













[Visual Studio Team Services](/team-services/) provides the tools you
need to continuously deliver
value





















#### What's new

  - [Surface
    Book 2](https://www.microsoft.com/en-us/surface/devices/surface-book-2/overview)
  - [Surface
    Pro](https://www.microsoft.com/en-us/surface/devices/surface-pro/overview)
  - [Xbox One X](https://www.xbox.com/en-us/xbox-one-x)
  - [Xbox One S](https://www.xbox.com/en-us/xbox-one-s?xr=shellnav)
  - [VR & mixed
    reality](https://www.microsoft.com/en-us/store/b/virtualreality)
  - [Windows 10
    apps](https://www.microsoft.com/en-us/windows/windows-10-apps)
  - [Office
apps](https://store.office.com/en-us/appshome.aspx?)





#### Store & Support

  - [Account profile](https://account.microsoft.com/)
  - [Download Center](https://www.microsoft.com/en-us/download)
  - [Sales &
    support](https://go.microsoft.com/fwlink/p/?LinkID=824761&clcid=0x409)
  - [Returns](https://go.microsoft.com/fwlink/p/?LinkID=824764&clcid=0x409)
  - [Order tracking](https://account.microsoft.com/orders)
  - [Store
    locations](https://www.microsoft.com/en-us/store/locations/find-a-store)
  - [Support](https://support.microsoft.com/en-us)
  - [Buy online, pick up in
    store](https://www.microsoft.com/en-us/store/b/buy-online-pick-up-in-store?icid=uhf_footer_bopuis)





#### Education

  - [Microsoft in education](https://www.microsoft.com/en-us/education)
  - [Office for
    students](https://www.microsoft.com/en-us/education/products/office/default.aspx)
  - [Office 365 for
    schools](https://products.office.com/en-us/academic/compare-office-365-education-plans)
  - [Deals for students &
    educators](https://www.microsoft.com/en-us/store/b/student)
  - [Microsoft Azure in
    education](https://azure.microsoft.com/en-us/community/education/)









#### Enterprise

  - [Microsoft Azure](https://azure.microsoft.com/)
  - [Enterprise](https://enterprise.microsoft.com/en-us/)
  - [Data platform](https://www.microsoft.com/en-us/sql-server/)
  - [Find a solutions
    provider](https://www.microsoft.com/en-us/solution-providers)
  - [Microsoft partner resources](https://partner.microsoft.com/en-us/)
  - [Microsoft
    AppSource](https://go.microsoft.com/fwlink/?LinkID=808093)
  - [Manufacturing &
    resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
  - [Financial
services](https://enterprise.microsoft.com/en-us)





#### Developer

  - [Microsoft Visual Studio](https://www.visualstudio.com/)
  - [Windows Dev Center](https://developer.microsoft.com/en-us/windows)
  - [Developer Network](https://msdn.microsoft.com/en-us)
  - [TechNet](https://technet.microsoft.com/en-us)
  - [Microsoft Virtual Academy](https://mva.microsoft.com/)
  - [Microsoft developer
    program](https://developer.microsoft.com/en-us/store/register)
  - [Channel 9](https://channel9.msdn.com/)
  - [Office Dev
Center](https://developer.microsoft.com/en-us/office)





#### Company

  - [Careers](https://careers.microsoft.com/)
  - [About Microsoft](https://www.microsoft.com/en-us/about)
  - [Company news](https://news.microsoft.com/)
  - [Privacy at Microsoft](https://privacy.microsoft.com/en-us)
  - [Investors](https://www.microsoft.com/investor/default.aspx)
  - [Diversity and
    inclusion](https://www.microsoft.com/en-us/diversity/)
  - [Accessibility](https://www.microsoft.com/en-us/accessibility/home)
  - [Security](https://www.microsoft.com/en-us/security/default.aspx)







[English (United States)](#)

  - [Contact us](https://beta.visualstudio.com/support/)
  - [Privacy &
    cookies](https://www.microsoft.com/EN-US/privacystatement/OnlineServices/Default.aspx)
  - [Terms of use](https://azure.microsoft.com/en-us/support/legal/)
  - [Trademarks](https://www.microsoft.com/trademarks)
  - [About our ads](http://choice.microsoft.com/)
  - © Microsoft 2018












