

[![feedback](https://www.visualstudio.com/wp-content/uploads/2017/01/feedback-button-normal.svg)](#)













[![](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31)
Microsoft](https://www.microsoft.com)



Visual
Studio



  - [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365)

  - [Azure](https://azure.microsoft.com)

  - [Office 365](https://products.office.com/en-us/business/office)

  - [Dynamics 365](https://dynamics.microsoft.com/en-us/)

  - [SQL](https://www.microsoft.com/sql-server/)

  - [Windows 10](https://www.microsoft.com/en-us/windowsforbusiness)

  - 
    
    
    
    More
    
      - Products & Services
          - [Windows
            Server](https://www.microsoft.com/cloud-platform/windows-server)
          - [Enterprise Mobility +
            Security](https://www.microsoft.com/cloud-platform/enterprise-mobility-security)
          - [Power
            BI](https://powerbi.microsoft.com/en-us/)
          - [Teams](https://products.office.com/en-us/microsoft-teams/group-chat-software)
          - [Visual Studio](https://www.visualstudio.com/)
          - [Surface for
            Business](https://www.microsoft.com/en-us/surface/business/overview)
      - Emerging Technologies
          - [AI](https://www.microsoft.com/ai/)
          - [Internet of
            Things](https://www.microsoft.com/internet-of-things)
          - [Azure Cognitive
            Services](https://azure.microsoft.com/services/cognitive-services/)
          - [Quantum](https://www.microsoft.com/quantum/)
          - [Research](https://www.microsoft.com/research/)
      - Developer & IT
          - [Docs](https://docs.microsoft.com/en-us/)
          - [TechNet](https://technet.microsoft.com/en-us/ms376608.aspx)
          - [Developer Network](https://msdn.microsoft.com/en-us)
          - [Windows Dev
            Center](https://developer.microsoft.com/en-us/windows)
          - [Windows IT Pro
            Center](https://www.microsoft.com/en-us/itpro/windows)
          - [FastTrack](https://fasttrack.microsoft.com/office)
      - Partner
          - [Partner Network](https://partner.microsoft.com/)
          - [Solution
            Providers](https://www.microsoft.com/solution-providers/)
          - [Partner
            Center](https://partnercenter.microsoft.com/partner/home)
          - [Cloud
            Hosting](https://www.microsoft.com/en-us/cloudandhosting)
      - Industries
          - [Education](https://www.microsoft.com/en-us/education)
          - [Financial
            services](https://enterprise.microsoft.com/en-us)
          - [Government](https://enterprise.microsoft.com/en-us/industries/government/)
          - [Health](https://enterprise.microsoft.com/en-us/industries/health/)
          - [Manufacturing &
            resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
          - [Retail](https://enterprise.microsoft.com/en-us/industries/retail-and-consumer-goods/)
      - Other
          - [Security](https://www.microsoft.com/security/)
          - [Licensing](https://www.microsoft.com/licensing/)
          - [AppSource](https://appsource.microsoft.com/)
          - [Azure
            Marketplace](https://azuremarketplace.microsoft.com/marketplace/)
          - [Events](https://events.microsoft.com/)
      - [View
all](https://www.microsoft.com/en-us/sitemap.aspx)
    
    













Sign
in

















[Visual Studio](https://www.visualstudio.com/) [Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

[Visual Studio Team
Services](https://www.visualstudio.com/team-services/)



Features

  - [Git](https://www.visualstudio.com/team-services/git/)
  - [TFVC](https://www.visualstudio.com/team-services/tfvc/)
  - [Agile
    Tools](https://www.visualstudio.com/team-services/agile-tools/)
  - [CI/CD](https://www.visualstudio.com/team-services/continuous-integration/)
  - [All Features](https://www.visualstudio.com/team-services/features/)





Pricing

  - [VSTS](https://www.visualstudio.com/team-services/pricing/)
  - [TFS](https://www.visualstudio.com/team-services/tfs-pricing/)
  - [Feature
    Comparisons](https://www.visualstudio.com/team-services/compare-features/)





News

  - [Release
    Notes](https://www.visualstudio.com/team-services/release-notes/)
  - [Microsoft DevOps Blog](https://blogs.msdn.microsoft.com/devops/)
  - [VSTS Customer
    Stories](https://www.visualstudio.com/team-services/case-studies/)





Support

  - [VSTS](https://www.visualstudio.com/team-services/support/)
  - [Team Foundation
    Server](https://www.visualstudio.com/team-services/tfs_support/)
  - [Documentation](https://docs.microsoft.com/en-us/vsts/index)
  - [FAQ](https://www.visualstudio.com/team-services/faq/)



[Subscriber
Access](https://my.visualstudio.com/Benefits?wt.mc_id=o~msft~vscom~nav&campaign=o~msft~vscom~nav)
[Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

































[Home](https://www.visualstudio.com)/Eliminating
Flaky
Tests



















# Eliminating Flaky Tests

### By Munil Shah



#### About the author





[Facebook](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Feliminating-flaky-tests%2F&t=Eliminating%20Flaky%20Tests "Facebook")[Twitter](https://twitter.com/share?text=Eliminating%20Flaky%20Tests&url=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Feliminating-flaky-tests%2F "Twitter")[Linkedin](https://www.linkedin.com/shareArticle?mini=true&url=https://www.visualstudio.com/learn/eliminating-flaky-tests/&title=Eliminating%20Flaky%20Tests&summary=Eliminating%20Flaky%20Tests%0D%0AThe%20next%20part%20of%20ensuring%20%27Master%20is%20Shippable%27%20was%20eliminating%20flaky%20tests.%20A%20test%20is%20flaky%20when%20it%20passes%20sometimes%20and%20fails%20sometimes%2C%20without%20any%20noticeable%20change%20in%20the%20code%2C%20tests%2C%20or%20environment.%20Some%20tests%20fail%2C%20then%20you%20 "Linkedin")[Email](mailto:?subject=Eliminating%20Flaky%20Tests&body=https://www.visualstudio.com/learn/eliminating-flaky-tests/ "Email")



















## Eliminating Flaky Tests

The next part of ensuring ‘Master is Shippable’ was eliminating flaky
tests. A test is flaky when it passes sometimes and fails sometimes,
without any noticeable change in the code, tests, or environment. Some
tests fail, then you re-run them and they pass. They are useless tests
and if left uncontrolled can completely destroy the value of an
automated regression suite. The primary benefit of having automated
tests is that they detect bugs by acting as regression tests.

On the flip side, having a great bug detection or deterministic quality
signal means you can find bugs early in the cycle. It increases your
confidence in making big changes. Flakiness can plague any kind of test,
but it’s particularly prone to affect tests with a broad scope,
functional
tests.













We needed a robust process to manage test flakiness.

## Our First Attempt to Remove Flaky Tests

Initially, we continued to run our old tests at the same time as the new
L2 tests. These are new functional tests and we wanted to make sure they
are highly reliable from the beginning. We would take a good build and
run tests in a tight loop 500 times, called a reliability run. If a test
fails at any time, we would declare it as flaky and file a test
reliability bug. These bugs show up on the team scorecard and the team
would fix those bugs. With a significant commitment from the leadership
to track and fix flaky tests with this approach, we were able to improve
the reliability of the L2 tests well over 90%.

It turns out 90+% reliability is good, but it is nowhere close to
sufficient. We needed tests that pass 100%. There were a couple of
reasons why this system didn’t get us close to 100%. First, the signal
coming out of the reliability run is not used immediately to filter out
tests. Instead it relied on engineers to watch for reliability bugs and
fix them. Second, the whole process was manual. The reliability runs
were done weekly and it required manual action to identify failures and
file bugs.

## Flaky Test Management – New Approach

We built a new system that addressed all these drawbacks.

![Flaky test management - new
approach](https://visualstudio.com/wp-content/uploads/2017/11/flaky-test-management-new-approach.png)

We used the reliability data automatically and immediately in the
official test run. The system would automatically file bugs for flaky
tests and the engineers were expected to fix those bugs quickly. The
flakiness data immediately appeared in team scorecard. The official run
didn’t remove flaky tests from the run, it simply filtered them out from
the results. This was a key innovation. We didn’t quarantine the tests,
we quarantine the results, which was much easier to do.

![Flaky test - new approach
worked](https://visualstudio.com/wp-content/uploads/2017/11/flaky-test-management-new-approach-worked.png)

The new approach worked. The CI runs became very green. The system
tracks resolution time on flaky test bugs and we fixed these bugs with
an average resolution time of 3.75 days. The system runs itself without
much manual intervention. And most importantly, the team trusts the CI
signal. When there is failure, the team immediately jumps on it to debug
the problem, because now it is likely a bug in the code that just got
merged and not a problem with the tests.

Below is what our CI pipeline looks like in action. Each column
represents a build and each row is a suite of tests we run on the CI
build. As you can see, it remains pretty green with runs passing 100%
vast majority of the time. There are occasional red cells, but the pass
rate is typically 99+%. It doesn’t take too long to investigate the
failures and take actions on them. The failures are removed fairly
quickly.

![CI pipeline in
action](https://visualstudio.com/wp-content/uploads/2017/11/ci-pipeline-in-action.jpg)



  [Munil
Shah](https://www.visualstudio.com/author/munils/ "Posts by Munil Shah")
  
2017-11-09T15:03:21+00:00 







![Munil
Shah](https://www.visualstudio.com/wp-content/uploads/2017/10/munils_avatar_1509056114-130x130.jpg)





### Munil Shah

As Partner Director of Engineering in Microsoft's Cloud and Enterprise
division, Munil Shah leads engineering for Visual Studio Team Services
and TFS products. Munil has over 20 years of experience building large
scale software and distributed services. Prior to his current role, he
held various engineering leadership positions Bing Advertising and
Windows groups at Microsoft. He is passionate about leading engineering
teams through significant transformation to deliver successful solutions
to customers.















  - [DevOps at
    Microsoft](https://www.visualstudio.com/learn/devops-at-microsoft/)
  - [How We Work with Visual Studio Team
    Services (VSTS)](#)
      - [Moving to Cloud
        Cadence](https://www.visualstudio.com/learn/moving-cloud-cadence/)
      - [How We Use Git at
        Microsoft](https://www.visualstudio.com/learn/use-git-microsoft/)
      - [Evolving Test Practices at
        Microsoft](https://www.visualstudio.com/learn/evolving-test-practices-microsoft/)
  - [How We Architect Visual Studio Team
    Services (VSTS)](#)
      - [From Monolith to Cloud
        Service](https://www.visualstudio.com/learn/monolith-cloud-service/)
      - [Achieving No Downtime Through
        Versioned Service
        Updates](https://www.visualstudio.com/learn/achieving-no-downtime-versioned-service-updates/)
      - [Progressive Experimentation with
        Feature
        Flags](https://www.visualstudio.com/learn/progressive-experimentation-feature-flags/)
      - [Patterns for Resiliency in the
        Cloud](https://www.visualstudio.com/learn/patterns-resiliency-cloud/)
      - [Shift Left to Make Testing Fast and
        Reliable](https://www.visualstudio.com/learn/shift-left-make-testing-fast-reliable/)
      - [Eliminating Flaky
        Tests](https://www.visualstudio.com/learn/eliminating-flaky-tests/)
      - [Shift Right to Test in
        Production](https://www.visualstudio.com/learn/shift-right-test-production/)
  - [One Engineering System at
    Microsoft](#)
      - [Moving 65,000 Microsofties to DevOps
        on the Public
        Cloud](https://www.visualstudio.com/learn/moving-65000-microsofties-devops-public-cloud/)
      - [Universal Store: Journey to
        Continuous Delivery and
        DevOps](https://www.visualstudio.com/learn/universal-store-journey-continuous-delivery-devops/)
  - [Microsoft Research on DevOps
    Productivity](#)
      - [Boosting your code reviews with
        useful
        comments](https://www.visualstudio.com/learn/boosting-code-reviews-useful-comments/)
      - [Code reviews are not (primarily) for
        finding
        bugs](https://www.visualstudio.com/learn/code-reviews-not-primarily-finding-bugs/)
      - [Code ownership and software
        quality](https://www.visualstudio.com/learn/code-ownership-software-quality/)
      - [Getting the noise out of test
        runs](https://www.visualstudio.com/learn/getting-noise-test-runs/)
      - [Improving software security with
        stack traces from bug
        reports](https://www.visualstudio.com/learn/improving-software-security-stack-traces-bug-reports/)
      - [Is 100% code coverage worth the
        cost?](https://www.visualstudio.com/learn/100-code-coverage-worth-cost/)
      - [Software testing at scale to
        increase
        velocity](https://www.visualstudio.com/learn/software-testing-scale-increase-velocity/)
      - [Test while building to maximize test
        effectiveness and minimize
        cost](https://www.visualstudio.com/learn/test-building-maximize-test-effectiveness-minimize-cost/)
      - [Using a simple code churn metric to
        find software
        bugs](https://www.visualstudio.com/learn/using-simple-code-churn-metric-find-software-bugs/)



















  - [** DevOps at Microsoft](/learn/devops-at-microsoft/)
  - [** Blog](https://blogs.msdn.microsoft.com/devops/)
  - [** Learn DevOps](/learn/what-is-devops/)
  - [![](/wp-content/uploads/2016/11/git-footer-icons-dark_2.png) Learn
    Git](/learn-git/)
  - [** Learn Agile](/agile/)
  - [** DevOps Self-Assessment](https://devopsassessment.net/)













[Visual Studio Team Services](/team-services/) provides the tools you
need to continuously deliver
value





















#### What's new

  - [Surface
    Book 2](https://www.microsoft.com/en-us/surface/devices/surface-book-2/overview)
  - [Surface
    Pro](https://www.microsoft.com/en-us/surface/devices/surface-pro/overview)
  - [Xbox One X](https://www.xbox.com/en-us/xbox-one-x)
  - [Xbox One S](https://www.xbox.com/en-us/xbox-one-s?xr=shellnav)
  - [VR & mixed
    reality](https://www.microsoft.com/en-us/store/b/virtualreality)
  - [Windows 10
    apps](https://www.microsoft.com/en-us/windows/windows-10-apps)
  - [Office
apps](https://store.office.com/en-us/appshome.aspx?)





#### Store & Support

  - [Account profile](https://account.microsoft.com/)
  - [Download Center](https://www.microsoft.com/en-us/download)
  - [Sales &
    support](https://go.microsoft.com/fwlink/p/?LinkID=824761&clcid=0x409)
  - [Returns](https://go.microsoft.com/fwlink/p/?LinkID=824764&clcid=0x409)
  - [Order tracking](https://account.microsoft.com/orders)
  - [Store
    locations](https://www.microsoft.com/en-us/store/locations/find-a-store)
  - [Support](https://support.microsoft.com/en-us)
  - [Buy online, pick up in
    store](https://www.microsoft.com/en-us/store/b/buy-online-pick-up-in-store?icid=uhf_footer_bopuis)





#### Education

  - [Microsoft in education](https://www.microsoft.com/en-us/education)
  - [Office for
    students](https://www.microsoft.com/en-us/education/products/office/default.aspx)
  - [Office 365 for
    schools](https://products.office.com/en-us/academic/compare-office-365-education-plans)
  - [Deals for students &
    educators](https://www.microsoft.com/en-us/store/b/student)
  - [Microsoft Azure in
    education](https://azure.microsoft.com/en-us/community/education/)









#### Enterprise

  - [Microsoft Azure](https://azure.microsoft.com/)
  - [Enterprise](https://enterprise.microsoft.com/en-us/)
  - [Data platform](https://www.microsoft.com/en-us/sql-server/)
  - [Find a solutions
    provider](https://www.microsoft.com/en-us/solution-providers)
  - [Microsoft partner resources](https://partner.microsoft.com/en-us/)
  - [Microsoft
    AppSource](https://go.microsoft.com/fwlink/?LinkID=808093)
  - [Manufacturing &
    resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
  - [Financial
services](https://enterprise.microsoft.com/en-us)





#### Developer

  - [Microsoft Visual Studio](https://www.visualstudio.com/)
  - [Windows Dev Center](https://developer.microsoft.com/en-us/windows)
  - [Developer Network](https://msdn.microsoft.com/en-us)
  - [TechNet](https://technet.microsoft.com/en-us)
  - [Microsoft Virtual Academy](https://mva.microsoft.com/)
  - [Microsoft developer
    program](https://developer.microsoft.com/en-us/store/register)
  - [Channel 9](https://channel9.msdn.com/)
  - [Office Dev
Center](https://developer.microsoft.com/en-us/office)





#### Company

  - [Careers](https://careers.microsoft.com/)
  - [About Microsoft](https://www.microsoft.com/en-us/about)
  - [Company news](https://news.microsoft.com/)
  - [Privacy at Microsoft](https://privacy.microsoft.com/en-us)
  - [Investors](https://www.microsoft.com/investor/default.aspx)
  - [Diversity and
    inclusion](https://www.microsoft.com/en-us/diversity/)
  - [Accessibility](https://www.microsoft.com/en-us/accessibility/home)
  - [Security](https://www.microsoft.com/en-us/security/default.aspx)







[English (United States)](#)

  - [Contact us](https://beta.visualstudio.com/support/)
  - [Privacy &
    cookies](https://www.microsoft.com/EN-US/privacystatement/OnlineServices/Default.aspx)
  - [Terms of use](https://azure.microsoft.com/en-us/support/legal/)
  - [Trademarks](https://www.microsoft.com/trademarks)
  - [About our ads](http://choice.microsoft.com/)
  - © Microsoft 2018












