

[![feedback](https://www.visualstudio.com/wp-content/uploads/2017/01/feedback-button-normal.svg)](#)













[![](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31)
Microsoft](https://www.microsoft.com)



Visual
Studio



  - [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365)

  - [Azure](https://azure.microsoft.com)

  - [Office 365](https://products.office.com/en-us/business/office)

  - [Dynamics 365](https://dynamics.microsoft.com/en-us/)

  - [SQL](https://www.microsoft.com/sql-server/)

  - [Windows 10](https://www.microsoft.com/en-us/windowsforbusiness)

  - 
    
    
    
    More
    
      - Products & Services
          - [Windows
            Server](https://www.microsoft.com/cloud-platform/windows-server)
          - [Enterprise Mobility +
            Security](https://www.microsoft.com/cloud-platform/enterprise-mobility-security)
          - [Power
            BI](https://powerbi.microsoft.com/en-us/)
          - [Teams](https://products.office.com/en-us/microsoft-teams/group-chat-software)
          - [Visual Studio](https://www.visualstudio.com/)
          - [Surface for
            Business](https://www.microsoft.com/en-us/surface/business/overview)
      - Emerging Technologies
          - [AI](https://www.microsoft.com/ai/)
          - [Internet of
            Things](https://www.microsoft.com/internet-of-things)
          - [Azure Cognitive
            Services](https://azure.microsoft.com/services/cognitive-services/)
          - [Quantum](https://www.microsoft.com/quantum/)
          - [Research](https://www.microsoft.com/research/)
      - Developer & IT
          - [Docs](https://docs.microsoft.com/en-us/)
          - [TechNet](https://technet.microsoft.com/en-us/ms376608.aspx)
          - [Developer Network](https://msdn.microsoft.com/en-us)
          - [Windows Dev
            Center](https://developer.microsoft.com/en-us/windows)
          - [Windows IT Pro
            Center](https://www.microsoft.com/en-us/itpro/windows)
          - [FastTrack](https://fasttrack.microsoft.com/office)
      - Partner
          - [Partner Network](https://partner.microsoft.com/)
          - [Solution
            Providers](https://www.microsoft.com/solution-providers/)
          - [Partner
            Center](https://partnercenter.microsoft.com/partner/home)
          - [Cloud
            Hosting](https://www.microsoft.com/en-us/cloudandhosting)
      - Industries
          - [Education](https://www.microsoft.com/en-us/education)
          - [Financial
            services](https://enterprise.microsoft.com/en-us)
          - [Government](https://enterprise.microsoft.com/en-us/industries/government/)
          - [Health](https://enterprise.microsoft.com/en-us/industries/health/)
          - [Manufacturing &
            resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
          - [Retail](https://enterprise.microsoft.com/en-us/industries/retail-and-consumer-goods/)
      - Other
          - [Security](https://www.microsoft.com/security/)
          - [Licensing](https://www.microsoft.com/licensing/)
          - [AppSource](https://appsource.microsoft.com/)
          - [Azure
            Marketplace](https://azuremarketplace.microsoft.com/marketplace/)
          - [Events](https://events.microsoft.com/)
      - [View
all](https://www.microsoft.com/en-us/sitemap.aspx)
    
    













Sign
in

















[Visual Studio](https://www.visualstudio.com/) [Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

[Visual Studio Team
Services](https://www.visualstudio.com/team-services/)



Features

  - [Git](https://www.visualstudio.com/team-services/git/)
  - [TFVC](https://www.visualstudio.com/team-services/tfvc/)
  - [Agile
    Tools](https://www.visualstudio.com/team-services/agile-tools/)
  - [CI/CD](https://www.visualstudio.com/team-services/continuous-integration/)
  - [All Features](https://www.visualstudio.com/team-services/features/)





Pricing

  - [VSTS](https://www.visualstudio.com/team-services/pricing/)
  - [TFS](https://www.visualstudio.com/team-services/tfs-pricing/)
  - [Feature
    Comparisons](https://www.visualstudio.com/team-services/compare-features/)





News

  - [Release
    Notes](https://www.visualstudio.com/team-services/release-notes/)
  - [Microsoft DevOps Blog](https://blogs.msdn.microsoft.com/devops/)
  - [VSTS Customer
    Stories](https://www.visualstudio.com/team-services/case-studies/)





Support

  - [VSTS](https://www.visualstudio.com/team-services/support/)
  - [Team Foundation
    Server](https://www.visualstudio.com/team-services/tfs_support/)
  - [Documentation](https://docs.microsoft.com/en-us/vsts/index)
  - [FAQ](https://www.visualstudio.com/team-services/faq/)



[Subscriber
Access](https://my.visualstudio.com/Benefits?wt.mc_id=o~msft~vscom~nav&campaign=o~msft~vscom~nav)
[Free
Account](https://go.microsoft.com/fwlink/?LinkId=307137&clcid=0x409&wt.mc_id=o~msft~vscom~product-vsts-nav~menu&campaign=o~msft~vscom~product-vsts-nav~menu)

































[Home](https://www.visualstudio.com)/How
We Use Git at
Microsoft



















# How We Use Git at Microsoft

### By Matt Cooper



#### About the author





[Facebook](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Fuse-git-microsoft%2F&t=How%20We%20Use%20Git%20at%20Microsoft "Facebook")[Twitter](https://twitter.com/share?text=How%20We%20Use%20Git%20at%20Microsoft&url=https%3A%2F%2Fwww.visualstudio.com%2Flearn%2Fuse-git-microsoft%2F "Twitter")[Linkedin](https://www.linkedin.com/shareArticle?mini=true&url=https://www.visualstudio.com/learn/use-git-microsoft/&title=How%20We%20Use%20Git%20at%20Microsoft&summary=How%20We%20Use%20Git%0D%0AWe%27ve%20talked%20a%20lot%20about%20hosting%20the%20world%27s%20largest%20Git%20repository%2C%20about%20how%20we%27re%20moving%20Microsoft%20to%20Git%2C%20and%20about%20the%20challenges%20of%20Git%20at%20scale.%20We%20often%20get%20asked%2C%20%22how%20does%20Microsoft%20actually%20use%20Git%3F%22%20and%2C%20while%20we%27ve%20given%20a%20litt "Linkedin")[Email](mailto:?subject=How%20We%20Use%20Git%20at%20Microsoft&body=https://www.visualstudio.com/learn/use-git-microsoft/ "Email")



















## How We Use Git

We’ve talked a lot about [hosting the world’s largest Git
repository](https://blogs.msdn.microsoft.com/bharry/2017/05/24/the-largest-git-repo-on-the-planet/),
about how we’re moving [Microsoft to
Git](https://www.youtube.com/watch?v=rKgBV4yfK3g), and about the
challenges of [Git at
scale](https://www.visualstudio.com/learn/git-at-scale/). We often get
asked, “how does Microsoft actually use Git?” and, while we’ve given [a
little
guidance](https://docs.microsoft.com/en-us/vsts/git/concepts/git-branching-guidance)
based on our learnings, we’d like to be more thorough. This will be a
whirlwind walkthrough of the standard Git workflow at Microsoft. There
are certainly teams which diverge from these principles in big and small
ways based on their needs, but by and large, these are the default
practices for most teams.

## The Team and Product Hosting Git

Other articles and videos on this site go into more detail about the
team and product makeup. As a refresher, there are around 500 engineers
in our organization. We’re geographically distributed into 3 main sites
(Redmond, Raleigh, and Hyderabad) plus dozens of remote workers in
cities across the world. We ship multiple products from our codebase:
Team Foundation Server comes out yearly and has several point updates
per year. Visual Studio Team Services ships every three weeks, plus a
daily hotfix train. These two products, though separate, share about 90%
of their code. In addition, we have several components built from our
repository which ship on a different schedule, such as Team Explorer for
Visual Studio. Everything we do with our code structure, branch
structure, and workflows is to support a large distributed team pumping
out complex software.

## Git Repository Structure

The majority of our code is in one Git repository hosted by VSTS. That
repository contains about 8GB worth of history on a fresh clone. We
follow a single-trunk model; more on our branch structure later.  
   
Code is broken up into components, which each live in their own
root-level folder. Really large components, especially some of the older
components, may be made up of multiple subcomponents. Those
subcomponents get separate sub-folders within the parent component.

![screenshot of Git repository
structure](/wp-content/uploads/2018/02/vso-files.png)

We have a few adjunct repositories, as well. For instance, our build &
release [agent](https://github.com/microsoft/vsts-agent) and
[tasks](https://github.com/microsoft/vsts-tasks), [VS Code
extension](https://github.com/Microsoft/vsts-vscode), and
[more](https://github.com/Microsoft?utf8=%E2%9C%93&q=vsts&type=&language=)
are developed in the open on GitHub. Configuration changes on Visual
Studio Team Services are checked into a separate repository. A handful
of other packages we depend on come from other places, and we consume
them via NuGet.

### Mono Repo or Multi-Repo with Git

It’s worth pausing to reflect that this isn’t the only way. While we’ve
elected to have a single monolithic repository (the “mono-repo”), other
products at Microsoft use a multi-repo approach. Skype, for instance,
has hundreds of small repositories that get stitched together in various
combinations to create their many different clients, services, and
tools. Especially for teams embracing microservices, multi-repo can be
the right approach. TFS/VSTS, like many products at Microsoft, began as
a monolith, and its code organization reflects that.

### Git Branch Structure and Policies

As in our [branch strategy
guide](https://docs.microsoft.com/en-us/vsts/git/concepts/git-branching-guidance),
we believe in a one-trunk model. We keep master buildable at all times
(more on that later) and work from short-lived topic branches. When
we’re ready to ship, whether that’s a sprint or a major TFS update, we
start a new release branch off master. Release branches never merge back
to master, so we require cherry-picking important changes. In the
diagram below, short-lived branches are shown in light blue and the
release branches are shown in dark blue. One branch with a commit that
needs cherry-picking is shown in red.

![screenshot of Git branch structure and
policies](/wp-content/uploads/2018/02/branch-strategy.png)  
We use a couple of VSTS features to help enforce this structure and keep
master clean. Branch policies prevent direct pushes to master. We
require a [successful
build](https://docs.microsoft.com/en-us/vsts/git/branch-policies#build-validation)
(including passing tests), [signoff by the
owners](https://docs.microsoft.com/en-us/vsts/git/branch-policies#automatically-include-code-reviewers)
of any code that was touched, and a handful of [external
checks](https://docs.microsoft.com/en-us/vsts/git/branch-policies#require-approval-from-external-services)
verifying corporate policies before a PR can be completed.

![screenshot of sign off
policy](/wp-content/uploads/2018/02/pr-policy.png)

We also like to keep our branch hierarchy tidy. We use permissions to
block creation of branches at the root level of the hierarchy. Everyone
can create branches in folders like users/, features/, and teams/. Only
release managers have permission to create branches under releases/, and
some automation tools have permission to the integrations/ folder.

![screenshot of branches](/wp-content/uploads/2018/02/vso-branches.png)

## Working in the Git Repository

Within this structure, how do engineers actually get their daily work
done? Obviously the environment’s going to vary heavily by team and by
individual – some people like the command line, others like Visual
Studio, and others work on different platforms. But the structures and
policies in place on our repository ensure a solid and consistent
foundation. Let’s walk through a handful of common tasks.

### Git Workflow to Build a New Feature

Our first stop has to be building a new feature. That’s the meat of a
software engineer’s job, right? We’ll skip past the non-Git parts like
looking at telemetry data, coming up with a design and a spec, and even
writing the actual code. Let’s jump right in to working with the
repository.  
   
First, the engineer syncs to the latest commit on master. We keep master
always buildable, so this is virtually guaranteed to be a good starting
point. The developer checks out a new feature branch, makes code
changes, commits, and pushes to the server. When our engineer starts a
pull request, several interesting things happen.

### Using Git Branch Policy

First, automated systems start checking that the new code builds, hasn’t
broken anything, and hasn’t violated any policies (security, compliance,
and so on). This doesn’t block other work from happening in parallel.
Most teams have configured [integration with Microsoft
Teams](https://marketplace.visualstudio.com/items?itemName=ms-vsts.vss-services-teams),
which announces the new PR to the engineer’s colleagues. The owners of
any code touched are automatically added as reviewers. We make liberal
use of optional reviewers for code that many people touch, like REST
client generation and shared controls, as a way to get expert eyes on
those changes.

![screenshot of teams
integration](/wp-content/uploads/2018/02/ms-teams-integration.png)

Once the people and the automation are satisfied, our engineer completes
the pull request. If there’s a merge conflict, the engineer is given
instructions on how to sync to the conflict, fix it, and re-push the
changes. The automation all runs again on the fixed code, but humans
don’t have to sign off again. Soon, we’ll be rolling out an extension
built by our friends in Windows which allows conflict resolution right
in the browser. That’s pretty amazing – by using an extensibility point,
the Windows team built something cool enough that we’re turning around
and including in our own workflow.  
   
VSTS merges the code to master, and it’ll deploy in the next sprint or
TFS release. Importantly, that doesn’t mean the new feature will show up
right away. We’ve talked elsewhere about how we decouple deployment and
exposure of new features using [feature
flags](https://www.visualstudio.com/learn/progressive-experimentation-feature-flags/).
This means even if the feature needs a little more bake time before it’s
ready to show off, if the product builds and deploys, it’s safe to go to
master. Once in master, the code ends up in an official build, where
it’s (again) tested, confirmed to meet policy, and digitally signed.

### Shipping

Deployment is a complex topic which we’ve [covered elsewhere on the
site](https://www.visualstudio.com/learn/achieving-no-downtime-versioned-service-updates/).
The branch model is the main intersection between deployment and Git. At
the end of each sprint, one of our release managers sends out an email
reminding people of the cut-off time. At the appointed time, the release
manager creates a new release branch off a particular commit, then lets
everyone know which commits are in and which ones missed the train.  
   
If an engineer misses the cutoff, he or she can (with permission)
cherry-pick the changes into the release branch. These cherry-picks go
through a PR to land in the release branch.

### Feature Flags Allow Code to Be Deployed with Controlled Exposure

As we deploy out through our rings and stages, controlling exposure with
feature flags, maybe we [discover an
issue](https://www.visualstudio.com/learn/shift-right-test-production/)
in production. Despite all our automation and review, things happen.
There’s no place like production\! Usually, we’re alerted by health
monitoring and telemetry when something isn’t right. A developer can –
you guessed it – create a branch off master, make a fix, and PR it into
master. Keeping the same general workflow means that developers don’t
have to context-switch or learn a different process for a (hopefully
rare) different code change.  
   
One additional step is required: to cherry-pick the change into the
release branch. We run a hotfix deployment out of the current release
branch each weekday morning, though we can also do this on demand for
urgent fixes. The fix actually hits production out of the release branch
first. But because we develop in master first, we know it won’t regress
the next sprint when a new release branch is created from master.  
   
Releases of the on-premises TFS are largely the same, though without the
deployment rings and stages. Also, because we do more manual testing on
different configurations and data shapes, there’s a longer tail between
cutting the release branch and putting the product in the hands of
customers.

## Git Facilitates our Shift Left

Working this way with Git gives us a number of benefits. First, we work
out of a single master, virtually eliminating merge debt. Second, the
pull request flow gives us a common point to force testing, code review,
and error detection early in the pipeline. This helps us shorten the
feedback cycle to developers – errors are usually detected in minutes,
not hours or days. Also, it gives us confidence when we refactor, since
all changes are tested all the time.  
   
Currently, we have more than 200 pull requests and 300 continuous
integration builds per day. Together, that amounts to 500 test runs
every 24 hours, a level that would have been a fantasy without this
workflow.



  [Matt
Cooper](https://www.visualstudio.com/author/mattc/ "Posts by Matt Cooper")
  
2018-02-01T12:40:54+00:00








![](https://secure.gravatar.com/avatar/430135977e33df497a125eef52420daf?s=130&d=mm&r=g)





### Matt Cooper

I'm currently a program manager for Visual Studio Team Services, focused
on version control. Previously I've worked on package management, Xbox,
and Dynamics CRM.















  - [DevOps at
    Microsoft](https://www.visualstudio.com/learn/devops-at-microsoft/)
  - [How We Work with Visual Studio Team
    Services (VSTS)](#)
      - [Moving to Cloud
        Cadence](https://www.visualstudio.com/learn/moving-cloud-cadence/)
      - [How We Use Git at
        Microsoft](https://www.visualstudio.com/learn/use-git-microsoft/)
      - [Evolving Test Practices at
        Microsoft](https://www.visualstudio.com/learn/evolving-test-practices-microsoft/)
  - [How We Architect Visual Studio Team
    Services (VSTS)](#)
      - [From Monolith to Cloud
        Service](https://www.visualstudio.com/learn/monolith-cloud-service/)
      - [Achieving No Downtime Through
        Versioned Service
        Updates](https://www.visualstudio.com/learn/achieving-no-downtime-versioned-service-updates/)
      - [Progressive Experimentation with
        Feature
        Flags](https://www.visualstudio.com/learn/progressive-experimentation-feature-flags/)
      - [Patterns for Resiliency in the
        Cloud](https://www.visualstudio.com/learn/patterns-resiliency-cloud/)
      - [Shift Left to Make Testing Fast and
        Reliable](https://www.visualstudio.com/learn/shift-left-make-testing-fast-reliable/)
      - [Eliminating Flaky
        Tests](https://www.visualstudio.com/learn/eliminating-flaky-tests/)
      - [Shift Right to Test in
        Production](https://www.visualstudio.com/learn/shift-right-test-production/)
  - [One Engineering System at
    Microsoft](#)
      - [Moving 65,000 Microsofties to DevOps
        on the Public
        Cloud](https://www.visualstudio.com/learn/moving-65000-microsofties-devops-public-cloud/)
      - [Universal Store: Journey to
        Continuous Delivery and
        DevOps](https://www.visualstudio.com/learn/universal-store-journey-continuous-delivery-devops/)
  - [Microsoft Research on DevOps
    Productivity](#)
      - [Boosting your code reviews with
        useful
        comments](https://www.visualstudio.com/learn/boosting-code-reviews-useful-comments/)
      - [Code reviews are not (primarily) for
        finding
        bugs](https://www.visualstudio.com/learn/code-reviews-not-primarily-finding-bugs/)
      - [Code ownership and software
        quality](https://www.visualstudio.com/learn/code-ownership-software-quality/)
      - [Getting the noise out of test
        runs](https://www.visualstudio.com/learn/getting-noise-test-runs/)
      - [Improving software security with
        stack traces from bug
        reports](https://www.visualstudio.com/learn/improving-software-security-stack-traces-bug-reports/)
      - [Is 100% code coverage worth the
        cost?](https://www.visualstudio.com/learn/100-code-coverage-worth-cost/)
      - [Software testing at scale to
        increase
        velocity](https://www.visualstudio.com/learn/software-testing-scale-increase-velocity/)
      - [Test while building to maximize test
        effectiveness and minimize
        cost](https://www.visualstudio.com/learn/test-building-maximize-test-effectiveness-minimize-cost/)
      - [Using a simple code churn metric to
        find software
        bugs](https://www.visualstudio.com/learn/using-simple-code-churn-metric-find-software-bugs/)



















  - [** DevOps at Microsoft](/learn/devops-at-microsoft/)
  - [** Blog](https://blogs.msdn.microsoft.com/devops/)
  - [** Learn DevOps](/learn/what-is-devops/)
  - [![](/wp-content/uploads/2016/11/git-footer-icons-dark_2.png) Learn
    Git](/learn-git/)
  - [** Learn Agile](/agile/)
  - [** DevOps Self-Assessment](https://devopsassessment.net/)













[Visual Studio Team Services](/team-services/) provides the tools you
need to continuously deliver
value





















#### What's new

  - [Surface
    Book 2](https://www.microsoft.com/en-us/surface/devices/surface-book-2/overview)
  - [Surface
    Pro](https://www.microsoft.com/en-us/surface/devices/surface-pro/overview)
  - [Xbox One X](https://www.xbox.com/en-us/xbox-one-x)
  - [Xbox One S](https://www.xbox.com/en-us/xbox-one-s?xr=shellnav)
  - [VR & mixed
    reality](https://www.microsoft.com/en-us/store/b/virtualreality)
  - [Windows 10
    apps](https://www.microsoft.com/en-us/windows/windows-10-apps)
  - [Office
apps](https://store.office.com/en-us/appshome.aspx?)





#### Store & Support

  - [Account profile](https://account.microsoft.com/)
  - [Download Center](https://www.microsoft.com/en-us/download)
  - [Sales &
    support](https://go.microsoft.com/fwlink/p/?LinkID=824761&clcid=0x409)
  - [Returns](https://go.microsoft.com/fwlink/p/?LinkID=824764&clcid=0x409)
  - [Order tracking](https://account.microsoft.com/orders)
  - [Store
    locations](https://www.microsoft.com/en-us/store/locations/find-a-store)
  - [Support](https://support.microsoft.com/en-us)
  - [Buy online, pick up in
    store](https://www.microsoft.com/en-us/store/b/buy-online-pick-up-in-store?icid=uhf_footer_bopuis)





#### Education

  - [Microsoft in education](https://www.microsoft.com/en-us/education)
  - [Office for
    students](https://www.microsoft.com/en-us/education/products/office/default.aspx)
  - [Office 365 for
    schools](https://products.office.com/en-us/academic/compare-office-365-education-plans)
  - [Deals for students &
    educators](https://www.microsoft.com/en-us/store/b/student)
  - [Microsoft Azure in
    education](https://azure.microsoft.com/en-us/community/education/)









#### Enterprise

  - [Microsoft Azure](https://azure.microsoft.com/)
  - [Enterprise](https://enterprise.microsoft.com/en-us/)
  - [Data platform](https://www.microsoft.com/en-us/sql-server/)
  - [Find a solutions
    provider](https://www.microsoft.com/en-us/solution-providers)
  - [Microsoft partner resources](https://partner.microsoft.com/en-us/)
  - [Microsoft
    AppSource](https://go.microsoft.com/fwlink/?LinkID=808093)
  - [Manufacturing &
    resources](https://enterprise.microsoft.com/en-us/industries/discrete-manufacturing/)
  - [Financial
services](https://enterprise.microsoft.com/en-us)





#### Developer

  - [Microsoft Visual Studio](https://www.visualstudio.com/)
  - [Windows Dev Center](https://developer.microsoft.com/en-us/windows)
  - [Developer Network](https://msdn.microsoft.com/en-us)
  - [TechNet](https://technet.microsoft.com/en-us)
  - [Microsoft Virtual Academy](https://mva.microsoft.com/)
  - [Microsoft developer
    program](https://developer.microsoft.com/en-us/store/register)
  - [Channel 9](https://channel9.msdn.com/)
  - [Office Dev
Center](https://developer.microsoft.com/en-us/office)





#### Company

  - [Careers](https://careers.microsoft.com/)
  - [About Microsoft](https://www.microsoft.com/en-us/about)
  - [Company news](https://news.microsoft.com/)
  - [Privacy at Microsoft](https://privacy.microsoft.com/en-us)
  - [Investors](https://www.microsoft.com/investor/default.aspx)
  - [Diversity and
    inclusion](https://www.microsoft.com/en-us/diversity/)
  - [Accessibility](https://www.microsoft.com/en-us/accessibility/home)
  - [Security](https://www.microsoft.com/en-us/security/default.aspx)







[English (United States)](#)

  - [Contact us](https://beta.visualstudio.com/support/)
  - [Privacy &
    cookies](https://www.microsoft.com/EN-US/privacystatement/OnlineServices/Default.aspx)
  - [Terms of use](https://azure.microsoft.com/en-us/support/legal/)
  - [Trademarks](https://www.microsoft.com/trademarks)
  - [About our ads](http://choice.microsoft.com/)
  - © Microsoft 2018












